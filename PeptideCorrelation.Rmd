---
output: html_document
editor_options: 
  chunk_output_type: console
---


```{r}
library(Hmisc)
library(scp)
library(scpdata)
library(dplyr)
library(ggplot2)
library(tidyr)
```

# Load data

```{r}
# View(as.data.frame(scpdata())) # Available data sets
scp <- specht2019v3() # Load specific data set
```

# Within peptides of a same protein

```{r}
df <- as.data.frame(rowData(scp[["peptides"]]))

peptide_assay <- assay(scp[["peptides"]])

all_cor_df <- DataFrame()

for (protein in rownames(assay(scp[["proteins"]]))) {
  
  peptides <- as.vector(df[, "peptide"][df[, "protein"] == protein])
  sub_pep_assay <- peptide_assay[peptides, ]
  
  if (length(peptides) >= 2) {
    res <- rcorr(t(sub_pep_assay), type = "pearson")
    ind <- which(upper.tri(res$r), arr.ind = TRUE)
    nn <- dimnames(res$r)
    temp_df <- data.frame(protein = rep(protein, length(ind)),
                          peptide1 = nn[[1]][ind[, 1]],
                          peptide2 = nn[[2]][ind[, 2]],
                          r = res$r[ind],
                          p = res$P[ind])
    all_cor_df <- rbind(all_cor_df, temp_df)
  }
}

all_cor_df <- all_cor_df[!duplicated(all_cor_df), ]
all_cor_df <- all_cor_df[!is.na(all_cor_df[c(5)]), ]
all_cor_df <- all_cor_df[all_cor_df$p != 0, ]
all_cor_df <- all_cor_df[all_cor_df$p < 0.01, ]

View(as.data.frame(all_cor_df))

ggplot() + aes(all_cor_df$r)+ geom_histogram(binwidth = 0.1,
                                        colour = "black", fill = "white")
```

# Between peptides of different proteins

```{r}
df <- as.data.frame(rowData(scp[["peptides"]]))

peptide_assay <- assay(scp[["peptides"]])

all_cor_df <- DataFrame()

for (protein in rownames(assay(scp[["proteins"]]))) {
  
  peptides <- as.vector(df[, "peptide"][df[, "protein"] == protein])
  sub_pep_assay <- peptide_assay[peptides, ]
  
  if (length(peptides) >= 2) {
    res <- rcorr(t(sub_pep_assay), type = "pearson")
    ind <- which(upper.tri(res$r), arr.ind = TRUE)
    nn <- dimnames(res$r)
    temp_df <- data.frame(protein = rep(protein, length(ind)),
                          peptide1 = nn[[1]][ind[, 1]],
                          peptide2 = nn[[2]][ind[, 2]],
                          r = res$r[ind],
                          p = res$P[ind])
    all_cor_df <- rbind(all_cor_df, temp_df)
  }
}

all_cor_df <- all_cor_df[!duplicated(all_cor_df), ]
all_cor_df <- all_cor_df[!is.na(all_cor_df[c(5)]), ]
all_cor_df <- all_cor_df[all_cor_df$p != 0, ]
all_cor_df <- all_cor_df[all_cor_df$p < 0.01, ]

View(as.data.frame(all_cor_df))

ggplot() + aes(all_cor_df$r)+ geom_histogram(binwidth = 0.1,
                                        colour = "black", fill = "white")
```







